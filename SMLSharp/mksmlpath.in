#!/bin/sh

if test "x$1" = "x-cm"; then
  MODE_CM=yes
  shift 1
else
  MODE_CM=no
fi

if test "x$1" = "x-sh"; then
  MODE_SH=yes
  shift 1
else
  MODE_SH=no
fi

FILENAME=$1

case "@host_os@" in
  # On Windows, we have two different version of SML/NJ runtime.
  # One is win32 runtime, this is the default system.
  # Another is cygwin runtime, this runtime is only activated when
  # SMLNJ_CYGWIN_RUNTIME is set.
  # Win32 runtime requires Windows form path, but on the other hand,
  # cygwin runtime requires UNIX form path.
  *cygwin*)
    case "@SML_HEAP_SUFFIX@" in
      *win32*)
        if test "x$MODE_CM" = "xyes"; then
          FILENAME=`@CYGPATH@ -aw "$FILENAME"`
        else
          FILENAME=`@CYGPATH@ -am "$FILENAME"`
        fi
        ;;
      *)
        FILENAME=`@CYGPATH@ -au "$FILENAME"`
        ;;
    esac
    ;;

  *mingw*)
    case "$FILENAME" in
      /[a-zA-Z]/*) FILENAME=`echo "$FILENAME" | sed 's,/\\(.\\)/,\\1:/,'` ;;
      /[a-zA-Z]) FILENAME=`echo "$FILENAME" | sed 's,/\\(.\\),\\1:/,'` ;;
      /*) root=`cd / && pwd -W`; FILENAME="$root$FILENAME" ;;
      [a-zA-Z]:*) ;;
      *) dir=`pwd -W`; FILENAME="$dir/$FILENAME" ;;
    esac
    FILENAME=`echo "$FILENAME" | sed -e 's,\\\\,/,g'`
    if test "x$MODE_CM" = "xyes"; then
      FILENAME=`echo "$FILENAME" | sed -e 's,/,\\\\,g'`
    fi
    ;;

  *)
    ;;
esac

FILENAME=`echo "$FILENAME" | sed -e 's/\\\\/\\\\\\\\/g' -e 's/"/\\\\"/g'`

if test "x$MODE_SH" = "xyes"; then
  FILENAME=`echo "$FILENAME" | sed -e 's/\\\\/\\\\\\\\/g' -e 's/"/\\\\"/g' \
                                   -e 's/\\\$/\\\\\$/g'`
fi

echo "$FILENAME"
