#!/bin/sh

HEAPNAME=$1
MAINFUNC=$2
if test -z "$MAINFUNC"; then
  MAINFUNC="Main.main"
fi

script=

if test "x$HEAPNAME" = "x--exec"; then
  script="$script SMLofNJ.Internals.GC.messages false;"
fi

if test "x@NEW_CM@" = "xyes"; then
  script="$script CM.make \"sources.cm\";"
else
  script="$script CM.make ();"
fi

if test "x$HEAPNAME" = "x--exec"; then
  script="$script $MAINFUNC;"
else
  case "@target_os@" in
    *cygwin*|*mingw*)
      HEAPNAME=`$SHELL @abs_top_builddir@/mksmlpath "$HEAPNAME"`
      ;;
  esac
  script="$script SMLofNJ.exportFn (\"$HEAPNAME\", $MAINFUNC);"
fi

echo "$script" | @SMLCM@
