srcdir = @srcdir@
builddir = @builddir@
top_srcdir = @top_srcdir@
top_builddir = @top_builddir@

include @top_builddir@/commonrule

VPATH = @srcdir@

SOURCES = main.cc libmain.cc

OBJECTS = $(SOURCES:.cc=.$(OBJEXT))

TARGETS = \
	smlsharprun$(EXEEXT) \
	libsmlsharprun.$(OBJEXT) \
	libsmlsharprun.$(LIBEXT) \
	libsmlsharprun.$(DLEXT) \

LOCAL_DEFS = $(RUNTIME_DEFS)
LOCAL_CPPFLAGS = $(RUNTIME_CPPFLAGS)

LIBFFI = $(LIBFFI_BUILD:libffi_build=../../libffi_build/.libs/libffi.$(LIBEXT))

ICONS_O = $(RESOURCE_TYPE:rc=../../icons/icons.$(OBJEXT))

LIBRARIES = ../../runtime-impl/main/libimlruntimeimpl.$(LIBEXT) \
            ../../runtime-core/main/libimlruntimecore.$(LIBEXT) \
            ../../../instructions/runtime/main/libimlinstructions.$(LIBEXT) \
            ../../../primitives/runtime/main/libimlprimitives.$(LIBEXT) \
            $(LIBFFI)

all: $(TARGETS)

clean:
	-rm -f $(OBJECTS) $(TARGETS)

install: $(TARGETS)
	$(INSTALL) -m 755 -d '$(DESTDIR)$(bindir)'
	$(INSTALL) -m 755 -d '$(DESTDIR)$(libdir)'
	$(INSTALL_PROGRAM) -m 755 smlsharprun$(EXEEXT) '$(DESTDIR)$(bindir)'
	$(INSTALL_PROGRAM) -m 755 libsmlsharprun.$(DLEXT) '$(DESTDIR)$(libdir)'
	$(INSTALL_PROGRAM) -m 755 libsmlsharprun.$(LIBEXT) '$(DESTDIR)$(libdir)'

smlsharprun$(EXEEXT): main.$(OBJEXT) $(LIBRARIES) $(ICONS_O)
	$(CXX) $(LDFLAGS) -o $@ main.$(OBJEXT) $(LIBRARIES) \
	       $(LIBSTDCXX) $(LIBS) $(ICONS_O)

libsmlsharprun.$(DLEXT): libmain.$(OBJEXT) $(LIBRARIES)
	$(CXX) $(LDFLAGS) $(DL_LDFLAGS) -o $@ libmain.$(OBJEXT) $(LIBRARIES) \
	       $(LIBSTDCXX) $(LIBS)

libsmlsharprun.$(LIBEXT): libmain.$(OBJEXT) $(LIBRARIES)
	@set -x; \
	mkdir libsmlsharp; \
	(cd libsmlsharp && for i in $(LIBRARIES); do $(AR) x ../$$i; done) && \
	$(AR) rcu $@ libmain.$(OBJEXT) libsmlsharp/*.$(OBJEXT); \
	status=$$?; \
	rm -f libsmlsharp/*; \
	rmdir libsmlsharp; \
	exit $$status
	-$(RANLIB) $@

libsmlsharprun.$(OBJEXT): libmain.$(OBJEXT) $(LIBRARIES)
	$(LD) -r -o $@ libmain.$(OBJEXT) $(LIBRARIES)

##---- dependency (automatically generated) ----
main.$(OBJEXT): main.cc main.hh \
  ../../../../src/runtime/runtime-impl/main/StandAloneSession.hh \
  ../../../../src/runtime/runtime-core/main/Session.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../.././config.h \
  ../../../../src/runtime/runtime-core/main/Reader.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/Writer.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/ExecutablePreProcessor.hh \
  ../../../../src/runtime/runtime-core/main/Executable.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/SystemError.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/SystemError.hh \
  ../../../../src/runtime/runtime-core/main/UserException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLException.hh \
  ../../../../src/runtime/runtime-impl/main/SessionBase.hh \
  ../../../../src/runtime/runtime-impl/main/VirtualMachine.hh \
  ../../../../src/runtime/runtime-impl/main/ExecutableLinker.hh \
  ../../../../src/runtime/runtime-impl/main/WordOperations.hh \
  ../../../../src/runtime/runtime-core/main/Log.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/Debug.hh \
  ../../../../src/runtime/runtime-impl/main/Heap.hh \
  ../../../../src/runtime/runtime-core/main/RuntimeTypes.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/NoEnoughHeapException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/SystemError.hh \
  ../../../../src/runtime/runtime-core/main/IllegalArgumentException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-impl/main/WordOperations.hh \
  ../../../../src/runtime/runtime-impl/main/EmptyHandlerStackException.hh \
  ../../../../src/runtime/runtime-core/main/IllegalStateException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/NoEnoughFrameStackException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/NoEnoughHandlerStackException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/OutOfMemoryException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/SystemError.hh \
  ../../../../src/runtime/runtime-impl/main/FFI.hh \
  ../../../../src/runtime/runtime-impl/main/EmptyHandlerStackException.hh \
  ../../../../src/runtime/runtime-core/main/InputChannel.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-impl/main/WordOperations.hh \
  ../../../../src/runtime/runtime-impl/main/VirtualMachine.hh \
  ../../../../src/runtime/runtime-impl/main/WordOperations.hh \
  ../../../../src/runtime/runtime-impl/main/InteractiveSession.hh \
  ../../../../src/runtime/runtime-impl/main/VirtualMachine.hh \
  ../../../../src/runtime/runtime-core/main/OutputChannel.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-impl/main/SessionBase.hh \
  ../../../../src/runtime/runtime-impl/main/FileLogFacade.hh \
  ../../../../src/runtime/runtime-impl/main/ByteArrayInputChannel.hh \
  ../../../../src/runtime/runtime-impl/main/FileInputChannel.hh \
  ../../../../src/runtime/runtime-impl/main/StreamInputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/FileOutputChannel.hh \
  ../../../../src/runtime/runtime-impl/main/StreamOutputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/ServerSocketChannel.hh \
  ../../../../src/runtime/runtime-impl/main/StreamInputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/StreamOutputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/ClientSocketChannel.hh \
  ../../../../src/runtime/runtime-impl/main/StreamInputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/StreamOutputChannelBase.hh \
  ../../../../src/instructions/runtime/main/Instructions.hh \
  ../../../../src/configuration/./Configuration.hh
libmain.$(OBJEXT): libmain.cc main.hh \
  ../../../../src/runtime/runtime-impl/main/StandAloneSession.hh \
  ../../../../src/runtime/runtime-core/main/Session.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../.././config.h \
  ../../../../src/runtime/runtime-core/main/Reader.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/Writer.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/ExecutablePreProcessor.hh \
  ../../../../src/runtime/runtime-core/main/Executable.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/SystemError.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/SystemError.hh \
  ../../../../src/runtime/runtime-core/main/UserException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLException.hh \
  ../../../../src/runtime/runtime-impl/main/SessionBase.hh \
  ../../../../src/runtime/runtime-impl/main/VirtualMachine.hh \
  ../../../../src/runtime/runtime-impl/main/ExecutableLinker.hh \
  ../../../../src/runtime/runtime-impl/main/WordOperations.hh \
  ../../../../src/runtime/runtime-core/main/Log.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/Debug.hh \
  ../../../../src/runtime/runtime-impl/main/Heap.hh \
  ../../../../src/runtime/runtime-core/main/RuntimeTypes.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/NoEnoughHeapException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/SystemError.hh \
  ../../../../src/runtime/runtime-core/main/IllegalArgumentException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-impl/main/WordOperations.hh \
  ../../../../src/runtime/runtime-impl/main/EmptyHandlerStackException.hh \
  ../../../../src/runtime/runtime-core/main/IllegalStateException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/NoEnoughFrameStackException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/NoEnoughHandlerStackException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/IMLRuntimeException.hh \
  ../../../../src/runtime/runtime-core/main/OutOfMemoryException.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-core/main/SystemError.hh \
  ../../../../src/runtime/runtime-impl/main/FFI.hh \
  ../../../../src/runtime/runtime-impl/main/EmptyHandlerStackException.hh \
  ../../../../src/runtime/runtime-core/main/InputChannel.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-impl/main/WordOperations.hh \
  ../../../../src/runtime/runtime-impl/main/VirtualMachine.hh \
  ../../../../src/runtime/runtime-impl/main/WordOperations.hh \
  ../../../../src/runtime/runtime-impl/main/InteractiveSession.hh \
  ../../../../src/runtime/runtime-impl/main/VirtualMachine.hh \
  ../../../../src/runtime/runtime-core/main/OutputChannel.hh \
  ../../../../src/runtime/runtime-core/main/SystemDef.hh \
  ../../../../src/runtime/runtime-impl/main/SessionBase.hh \
  ../../../../src/runtime/runtime-impl/main/FileLogFacade.hh \
  ../../../../src/runtime/runtime-impl/main/ByteArrayInputChannel.hh \
  ../../../../src/runtime/runtime-impl/main/FileInputChannel.hh \
  ../../../../src/runtime/runtime-impl/main/StreamInputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/FileOutputChannel.hh \
  ../../../../src/runtime/runtime-impl/main/StreamOutputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/ServerSocketChannel.hh \
  ../../../../src/runtime/runtime-impl/main/StreamInputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/StreamOutputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/ClientSocketChannel.hh \
  ../../../../src/runtime/runtime-impl/main/StreamInputChannelBase.hh \
  ../../../../src/runtime/runtime-impl/main/StreamOutputChannelBase.hh \
  ../../../../src/instructions/runtime/main/Instructions.hh
