#!/bin/sh

set -e

NAME=$1
HEAPDIR=$2

if test "$#" -gt "2" ; then
  DSTFILE=$3
else
  DSTFILE="$NAME"
fi

case "@target_os@" in
*cygwin*|*mingw*)
  HEAPIMAGE=`$SHELL @abs_top_builddir@/mksmlpath -sh "$HEAPDIR/$NAME"`
  ;;
*)
  HEAPIMAGE="$HEAPDIR/$NAME"
  case "$HEAPIMAGE" in
  /*) ;;
  *) HEAPIMAGE="$PWD/$HEAPIMAGE" ;;
  esac
  ;;
esac

if test -n "@CMD@"; then
  cat <<END > "$DSTFILE"
#!/bin/sh
'@CMD@' /c "@SML_BAT@ @SMLload=$HEAPIMAGE \$*"
END
else
  cat <<END > "$DSTFILE"
#!/bin/sh
exec @SML@ @SMLload="$HEAPIMAGE" "\$@"
END
fi

chmod +x "$DSTFILE"
