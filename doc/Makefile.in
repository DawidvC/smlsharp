srcdir = @srcdir@
builddir = @builddir@
top_srcdir = @top_srcdir@
top_builddir = @top_builddir@

include @top_builddir@commonrule

VPATH = $(srcdir)

# FIXME: all generating files should be placed in builddir, not in srcdir.

doc:
	-$(MAKE) doxygen
	-$(MAKE) smldoc

doxygen:
	@if test 'x$(DOXYGEN)' = 'x'; then \
	  echo '*** doxygen not found.'; exit 1; \
	fi
	-rm -rf $(srcdir)/runtime
	mkdir $(srcdir)/runtime
	mkdir $(srcdir)/runtime/IML-runtime
	cd $(srcdir) && $(DOXYGEN) doxygen.cfg
	mkdir $(srcdir)/runtime/test
	cd $(srcdir) && $(DOXYGEN) doxygen_test.cfg

smldoc:
	@if test 'x$(SMLDOC)' = 'x'; then \
	  echo '*** smldoc not found.'; exit 1; \
	fi
	-rm -rf $(srcdir)/compiler
	mkdir $(srcdir)/compiler
	cd $(srcdir) && $(SMLDOC) -a smldoc.cfg

clean:
	-rm -rf $(srcdir)/runtime $(srcdir)/compiler
