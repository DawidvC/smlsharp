srcdir = @srcdir@
builddir = @builddir@
top_srcdir = @top_srcdir@
top_builddir = @top_builddir@

include @top_builddir@commonrule

TEMPLATES = $(srcdir)/../../compiler/main/Primitives.ppg.in \
            $(srcdir)/../../runtime/main/Primitives.cc.in \
            $(srcdir)/../../runtime/main/Primitives.hh.in \
            $(srcdir)/../../../instructions/Instructions.sml.in \
            $(srcdir)/../../compiler/main/Constants.sml.in \
            $(srcdir)/../../runtime/main/Constants.cc.in \
            $(srcdir)/../../runtime/main/Constants.hh.in

TARGETS = $(TEMPLATES:.in=)

all: $(TARGETS)

$(TARGETS): $(TEMPLATES)
	cd $(srcdir) && (echo 'CM.make(); main();' | $(SMLCM))

clean:
	-rm -rf $(srcdir)/CM
	-rm -f $(TEMPLATES:.in=)
