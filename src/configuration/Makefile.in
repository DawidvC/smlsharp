srcdir = @srcdir@
builddir = @builddir@
top_srcdir = @top_srcdir@
top_builddir = @top_builddir@

include @top_builddir@commonrule

VPATH = $(srcdir)

TARGETS = $(srcdir)/Configuration.sml

all: $(TARGETS)

install: $(TARGETS)
	$(INSTALL) -m 755 -d '$(DESTDIR)$(libdir_smlsharp)'
	$(INSTALL_DATA) $(srcdir)/Configuration.sml '$(DESTDIR)$(libdir_smlsharp)'

clean:
	-rm -rf $(srcdir)/CM $(srcdir)/.cm
	-rm -f $(TARGETS)

$(srcdir)/Configuration.sml: Configuration.sml.in Makefile \
                             $(srcdir)/cvsid.sh \
                             $(top_builddir)mksmlpath
	if grep '%SNAPSHOT_DATE%' $(srcdir)/Configuration.sml.in > /dev/null 2>&1; then \
	  cvsid=`$(SHELL) $(srcdir)/cvsid.sh $(top_srcdir)/src`; \
	fi; \
	sed -e "s,%BUILD_ROOT%,`$(MKSMLPATH) -sh '$(BUILD_ROOT)'`," \
	    -e "s,%SRC_ROOT%,`$(MKSMLPATH) -sh '$(SRC_ROOT)'`," \
	    -e "s,%EXEEXT%,$(EXTEXT)," \
	    -e "s,%BINDIR%,`$(MKSMLPATH) -sh '$(bindir)'`," \
	    -e "s,%LIBDIR%,`$(MKSMLPATH) -sh '$(libdir_smlsharp)'`," \
	    -e "s,%SNAPSHOT_DATE%,$$cvsid," \
	    -e "s,%SMLSHARP_PLATFORM%,$(SMLSHARP_PLATFORM)," \
	    $(srcdir)/Configuration.sml.in > $@
